### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Page 1 : récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
i <- 1
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
l
### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Page 1 : récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
i <- 2
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
l
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
l
linksParis <- paste(root,gsub("^../../","",l),sep="/")
linksParis
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
if (i>2){listURLS <- c(listURLS,l)} else {listURLS <- l}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
linksDepts
i <- 1
linksDepts[i]
url <- linksDepts[i]
w <- read_html(x = url)
w
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
l
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
l
url <- linksDepts[i]
url
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
linksParis
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text())
n
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text())
n
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
n
n <- paste ("Paris",n,sep=" ")
n
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
ListWebPages
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
ListWebPages
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%   html_text()
n
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%   html_text()
if (i>2){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,n)
} else {
listURLS <- l
listLABELS <- n
}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
listLABELS
listLABELS
linksDepts
listLABELS
i <- 2
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%   html_text()
n
### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Niveau 1 ----------------------------------
# récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
# Niveau 2 ----------------------------------
# récupération liens des pages pour Paris
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes("a")%>% html_text()
if (i>2){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,n)
} else {
listURLS <- l
listLABELS <- n
}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
listLABELS
### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Niveau 1 ----------------------------------
# récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
# Niveau 2 ----------------------------------
# récupération liens des pages pour Paris
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
# récupération des liens des départements
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
if (i>2){
listURLS <- c(listURLS,l)
} else {
listURLS <- l
}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
l
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
n
linksDepts
length(linksDepts)
i <- 1
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,l)
} else {
listURLS <- l
listLABELS <- l
}
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,l)
} else {
listURLS <- l
listLABELS <- l
}
}
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,l)
} else {
listURLS <- l
listLABELS <- l
}
}
listURLS
lenght(listURLS)
length(listURLS)
length(listLABELS)
linksCom <- paste(root,gsub("^../../","",listURLS),sep="/")
linksCom
ListWebPages <- rbind(ListWebPages,ListWebPages2)
ListWebPages2 <- data.frame(listLABELS,linksCom)
ListWebPages2
head(ListWebPages2)
### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Niveau 1 ----------------------------------
# récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
# Niveau 2 ----------------------------------
# récupération liens des pages pour Paris
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
# récupération des liens des départements
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
if (i>2){
listURLS <- c(listURLS,l)
} else {
listURLS <- l
}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
# Niveau 2 ----------------------------------
# récupération liens des pages chaque département
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,l)
} else {
listURLS <- l
listLABELS <- n
}
}
linksCom <- paste(root,gsub("^../../","",listURLS),sep="/")
ListWebPages2 <- data.frame(listLABELS,linksCom)
ListWebPages <- rbind(ListWebPages,ListWebPages2)
### WEBSCRAPPING DONNES ELECTORALES MINISTERE INTERIEUR
library(xml2)
library(rvest)
# Niveau 1 ----------------------------------
# récupération des liens des départements
root <- "http://www.interieur.gouv.fr/Elections/Les-resultats/Regionales/elecresult__regionales-2015/(path)/regionales-2015"
url <- paste(root,"11/11.html",sep="/")
webpage <- read_html(x = url)
links <- webpage %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
links <- paste(root,gsub("^../","",links),sep="/")
url <- links[1]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_text()
labelsParis <- paste ("Paris",n,sep=" ")
linksParis <- paste(root,gsub("^../../","",l),sep="/")
ListWebPages <- data.frame(labelsParis,linksParis)
ListWebPages
for (i in 2 : length(links)){
url <- links[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".pub-index-communes") %>% html_nodes(".offset2") %>% html_nodes("a")%>%  html_attr("href")
if (i>2){
listURLS <- c(listURLS,l)
} else {
listURLS <- l
}
}
linksDepts <- paste(root,gsub("^../../","",listURLS),sep="/")
linksDepts
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,l)
} else {
listURLS <- l
listLABELS <- n
}
}
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,n)
} else {
listURLS <- l
listLABELS <- n
}
}
for(i in 1:length(linksDepts)){
url <- linksDepts[i]
w <- read_html(x = url)
l <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>%  html_attr("href")
n <- w %>% html_nodes(".tableau-communes") %>% html_nodes("a")%>% html_text()
if (i>1){
listURLS <- c(listURLS,l)
listLABELS <- c(listLABELS,n)
} else {
listURLS <- l
listLABELS <- n
}
}
linksCom
linksCom
length(linksCom)
length(listLABELS)
ListWebPages2 <- data.frame(listLABELS,linksCom)
ListWebPages <- rbind(ListWebPages,ListWebPages2)
names(listLABELS)
names(ListWebPages2)
colnames(ListWebPages2) <- names(ListWebPages)
names(ListWebPages2)
colnames(ListWebPages) <- c("name","url")
colnames(ListWebPages2) <- c("name","url")
ListWebPages <- rbind(ListWebPages,ListWebPages2)
ListWebPages
head(ListWebPages)
url <- ListWebPages[i]
url <- ListWebPages$url[i]
w <- read_html(x = url)
url <- ListWebPages$url[i]
w <- read_html(x = url)
url
url <- as.character(ListWebPages$url[i])
w <- read_html(x = url)
w
varx <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("a")%>%  html_attr("href")
varx
varx <- w %>% html_nodes(".pub-resultats-entete")
varx
varx <- w %>% html_nodes(".pub-resultats-entete") %>%> html_nodes(".offset2")
varx
varx <- w %>% html_nodes(".pub-resultats-entete") %>%> html_nodes(".offset2")
varx <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes(".offset2")
varx
varx <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes(".offset2")%>% html_nodes("td")
varx
varx <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")
varx
varx[3]
varx <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")[3]
div <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")
div
Pecresse <- div[3]
Pecresse
div <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")%>%html_nodes(".text-right)
div
div <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")%>%html_nodes(".text-right")
div
div <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")
Pecresse <- div[3]
Pecresse
Pecresse <- gsub('^<td class="text-right">',"",div[3])
Pecresse
Pecresse <- gsub('</td>">',"",Pecresse)
Pecresse
Pecresse
Pecresse <- gsub('</td>">',"",Pecresse)
Pecresse
Pecresse <- gsub('$</td>">',"",Pecresse)
Pecresse
Pecresse
Pecresse <- gsub('$</td>>',"",Pecresse)
Pecresse
Pecresse <- gsub('^<td class="text-right">',"",div[3])
Pecresse
Pecresse <- gsub('$</td>',"",Pecresse)
Pecresse
Pecresse <- gsub('</td>',"",Pecresse)
Pecresse
Pecresse <- as.numeric(Pecresse)
Pecresse
Pecresse <- gsub('^<td class="text-right">',"",div[3])
Pecresse <- gsub('</td>',"",Pecresse)
Pecresse <- as.numeric(Pecresse)
Pecresse
url <- as.character(ListWebPages$url[i])
w <- read_html(x = url)
var_name <- ListWebPages$name[i]
div <- w %>% html_nodes(".pub-resultats-entete") %>% html_nodes("td")
div
ListWebPages
div
url <- as.character(ListWebPages$url[i])
url
Inscrits <- gsub('^<td class="text-right">',"",div[17])
Inscrits <- gsub('</td>',"",Inscrits)
Inscrits <- as.numeric(Inscrits)
Inscrits
div
library("rgdal")
library("cartography")
setwd(é/home/nlambert/Documents/POLITIQUE/votePCF")
setwd("/home/nlambert/Documents/POLITIQUE/votePCF")
setwd("/home/nlambert/Documents/POLITIQUE/votePCF")
dpts.spdf <-readOGR(dsn ="input",layer = "DEPARTEMENT.shp")
dpts.spdf <-readOGR(dsn ="input",layer = "DEPARTEMENT")
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep=";",dec=",",encoding="utf-8",)
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep=";",dec=",",encoding="utf-8")
head(pcf.df)
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep="\t",dec=",",encoding="utf-8")
head(pcf.df)
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep="\t",dec=".",encoding="utf-8")
head(pcf.df)
head(pcf.df)
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016 ")]
data.df <- pcf.df[c("Exprimés_2016","Option1_2016 "),]
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
head(data.df$pct_jlm2016 )
head(data.df$pct_jlm2016)
data.df <- pcf.df[c("Exprimés_2016","Option1_2016"),]
data.df
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
head(data.df$pct_jlm2016)
data.df
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
pcf.df
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df
pcf.df
head(pcf.df)
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df
pcf.df
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df <- pcf.df[c("Exprimés_2016","Option1_2016")]
data.df
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
data.df
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
head(data.df$pct_jlm2016)
head(pcf.df)
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
data.df$pct_jlm2016
data.df$Option1_2016
data.df$Exprimés_2016
data.df <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df
c <- pcf.df[,c("Exprimés_2016","Option1_2016")]
c
# ********************************
# VOTE PCF
# ********************************
library("rgdal")
library("cartography")
# Import
setwd("/home/nlambert/Documents/POLITIQUE/votePCF")
dpts.spdf <-readOGR(dsn ="input",layer = "DEPARTEMENT")
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep="\t",dec=".",encoding="utf-8")
c <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df$pct_jlm2016 <- (data.df$Option1_2016/data.df$Exprimés_2016)*100
data.df
# ********************************
# VOTE PCF
# ********************************
library("rgdal")
library("cartography")
# Import
setwd("/home/nlambert/Documents/POLITIQUE/votePCF")
dpts.spdf <-readOGR(dsn ="input",layer = "DEPARTEMENT")
pcf.df <-read.csv( "input/pcf.csv",header=TRUE,sep="\t",dec=".",encoding="utf-8")
# Vote Mélenchon 2016
c <- pcf.df[,c("Exprimés_2016","Option1_2016")]
data.df
